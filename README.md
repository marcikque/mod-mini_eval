# Benchmarking Modifications to Minimap2

This repository contains a shell script designed to benchmark modifications made to the [minimap2](https://github.com/lh3/minimap2) program. 
The script automates the process of calculating various metrics of different versions of minimap2 using various flags across the [Aliivibrio fischeri dataset](https://www.ncbi.nlm.nih.gov/bioproject/PRJNA12986/).

## Table of Contents

- [Requirements](#requirements)
  - [Software](#software)
  - [File Structure](#file-structure)
- [Implementation Details](#implementation-details)
  - [Flags Used](#flags-used)
  - [Benchmark Process](#benchmark-process)
- [Output](#output)
  - [Directory Structure](#directory-structure)
  - [Generated Files](#generated-files)
- [Notes](#notes)

## Requirements

### Software

Ensure the following software is installed and accessible system-wide (i.e., included in your `PATH` environment variable):

- wget
- tar
- unzip
- [samtools](http://www.htslib.org/)

### File Structure

Your working directory should have the following structure:

```
. 
├── minimap2/ 
├── minimap2_mod-mini/ 
└── mod-mini_eval/ 
    └── benchmark.sh
```
    
- `minimap2/`: Directory containing the original minimap2 source code, built and ready for execution.
- `minimap2_mod-mini/`: Directory containing the modified version of minimap2, also built and ready for execution.
- `mod-mini_eval/benchmark.sh`: The benchmarking script to be executed.

**Note:** Both `minimap2` and `minimap2_mod-mini` must be built and executable before running the benchmark script.

## Implementation Details

The script will:

- Download necessary benchmark datasets.
- Run benchmarks using different versions of minimap2 with specified flags.
- Collect and organize output data for analysis.

### Flags Used

The script benchmarks minimap2 using the following list of flags:

    FLAGS=("-a" "-a -H" "-a -x sr")

These flags are applied to each version of minimap2 during the benchmarking process.

- `-a`: Outputs a SAM file with CIGAR for accuracy evaluation
- `-H`: Uses homopolymer-compressed minimizers
- `-x sr`: Focuses on short single-end reads without splicing

### Benchmark Process

1. **Data Download**: The required datasets for benchmarking are downloaded using `wget` and extracted with `tar`.
2. **Execution**: Minimap2 is executed with the specified flags on each dataset.
3. **Data Collection**: Output data, including terminal output and statistics, are collected.
4. **Repetition**: Steps 2 and 3 are repeated for all combinations, resulting in 54 total runs (3 versions × 3 flags × 6 datasets).

## Output

### Directory Structure

After running the script, the output directory will have the following structure:

```
.
├── minimap2_default
├── minimap2_HPC
├── minimap2_mod-mini_default
├── minimap2_mod-mini_HPC
├── minimap2_mod-mini_SR
├── minimap2_mod-mini_w8_default
├── minimap2_mod-mini_w8_HPC
├── minimap2_mod-mini_w8_SR
└── minimap2_SR
```

Each subdirectory corresponds to a specific version and flag combination.

### Generated Files

Within each flag directory, you will find 6 files, each corresponding to one run. These files consist of:

- The exact command used for that run.
- Terminal output from minimap2 execution.
- Statistics generated by `samtools flagstat`.
- Number of high-quality reads identified in the run.

This results in a total of 54 files corresponding to the individual runs.

## Notes

- **Execution Time**: The benchmarking process may take several hours depending on your system's specifications.
- **Data Storage**: During the benchmarking, there will be temporary files created with a total size of up to 5GB. Ensure that you have sufficient storage space for this.
